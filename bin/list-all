#!/usr/bin/env bash

## Determine the latest stable version of a tool.
## https://asdf-vm.com/plugins/create.html#bin-latest-stable

set -euo pipefail

export ASDF_PLUGIN_SCRIPT=${BASH_SOURCE[0]}
export ASDF_PLUGIN_PATH
ASDF_PLUGIN_PATH=$(dirname "$(dirname "$ASDF_PLUGIN_SCRIPT")")

# shellcheck source-path=SCRIPTDIR/../lib/commands.sh
source "${ASDF_PLUGIN_PATH:?}/lib/commands.sh"

## -----------------------------------------------------------------------

## cmctl is provided since cert-manager v1.6.0.
## https://cert-manager.io/docs/release-notes/release-notes-1.6/
version_regex='1.([6-9]|[1-9][0-9]+)'

asdf_list_git_tags |
  asdf_version_only 'v' |
  asdf_version_format 'v' |
  asdf_version_regex "$version_regex" |
  asdf_version_sort |
  xargs echo
